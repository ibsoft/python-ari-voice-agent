# config.yaml

# ───────────── OpenAI / Project (προαιρετικά) ─────────────
openai:
  project: null
  organization: null

# ───────────── ARI / Asterisk ─────────────
ari:
  host: "http://192.168.1.29"
  port: 8088
  username: "aiagent"
  password: "supersecret"
  app: "ai_agent"
  tenant_id_var: "X-Tenant-Id"
  verify_ssl: false
  http_timeout_sec: 5.0

# ───────────── ExternalMedia (RTP) ─────────────
external_media:
  bind_ip: "192.168.1.218"
  port_min: 30000
  port_max: 40050

# ───────────── Χαιρετισμός ─────────────
greeting_text: "Καλησπέρα! Είμαι ο Πέτρος, τεχνικός υποστήριξης AI της UNIXFOR. Πώς μπορώ να σας βοηθήσω;"

# ───────────── Agent / Συνομιλία ─────────────
agent:
  agent_id: "petros"
  model: "gpt-4o-mini"
  rag_only: true
  non_rag_smalltalk_ok: true
  ack_enabled: false
  temperature: 0.2
  max_output_tokens: 380
  instructions: |
    Είσαι ο «Πέτρος», εξειδικευμένος τεχνικός υποστήριξης της UNIXFOR για συστήματα APS compact NL & APS Cashless TTW (Through the wall).
    Μίλα αποκλειστικά Ελληνικά, με σύντομες και καθαρές παραγράφους, χωρίς bullets ή SSML.
    Για τεχνικές απαντήσεις χρησιμοποίησε ΑΠΟΚΛΕΙΣΤΙΚΑ το περιεχόμενο του file_search.
    Αν η απάντηση από το file_search πελιλαμβάνει βήματα, πχ. ( 1. 2. 3...) ανάφερε τα πιστά και μην παραλείψεις κανένα, ούτε να προσθέσεις άλλα φανταστικά.
    Αν δεν υπάρχει επαρκές υλικό, πες το ρητά, ζήτα διευκρίνιση ή πρότεινε μεταφορά σε τεχνικό.
    Μην αναφέρεις ονόματα αρχείων ή πηγές. Μην εφευρίσκεις πληροφορίες.
    Πριν προτείνεις μεταφορά σε τεχνικό, ρώτα αν θέλει μεταφορά.
    Αν γνωρίζεις το επώνυμο του καλούντος, να τον προσφωνείς ως «Κύριε <Επώνυμο-στην-κλητική>» ή «Κ. <Επώνυμο>».
    ΚΑΝΟΝΕΣ ΜΕΤΑΦΟΡΑΣ:
    - Μεταφορά όταν ο χρήστης τη ζητά ρητά ή όταν δεν υπάρχει διαθέσιμη λύση
    - Αν ο χρήστης απαντήσει καταφατικά σε «να σας συνδέσω;», προχώρα άμεσα.
    - Πάντα σύντομη επιβεβαίωση πριν τη μεταφορά.
    Παραδείγματα που πρέπει να μεταφέρεις:
    - Θέλω να μιλήσω με τεχνικό → TRANSFER
    - Θέλω να μιλήσω με εκπρόσωπο → TRANSFER
    - Μπορώ να μιλήσω με άνθρωπο; → TRANSFER
    - Δεν μπορείτε να με βοηθήσετε → TRANSFER
    - Αυτό είναι πολύ περίπλοκο → TRANSFER
    Κράτα τις απαντήσεις σε το πολύ τέσσερις σύντομες προτάσεις ή αριθμημένα βήματα και πες μόνο το απολύτως απαραίτητο.

  wait_phrases: []
  wait_only_with_file_search: true
  waiter_trailing_ms: 500
  slow_tts_wait_ms: 700
  wait_delay_variation_ms: 300
  wait_repeat_schedule_sec: [5, 7, 12]
  max_wait_messages: 2
  no_wait_smalltalk: true
  wait_every_turn: false
  conversation_memory_size: 1
  user_data_file: "user_data.pkl"
  ack_exclamations:
    - "Μάλιστα."
  max_response_chars: 480

# ───────────── Retrieval / File Search ─────────────
retrieval:
  enabled: true
  mode: "elastic"  # "openai_file_search" για OpenAI vector stores ή "elastic" για Elasticsearch
  vector_store_ids:
    - "vs_68e7a4fdcca08191880b1d2b775b724b"
  max_num_results: 8
  deny_without_sources: true
  require_min_matches: 1
  instructions: |
    Μίλα Ελληνικά, σε σύντομες παραγράφους χωρίς markup.
    Απάντησε αποκλειστικά από τα αποσπάσματα που σού δίνουμε (file_search ή Elasticsearch). Μην συμπληρώνεις κενά από μνήμη.
    Αν δεν βρεις ακριβείς οδηγίες, δήλωσε ότι δεν υπάρχουν επαρκείς πληροφορίες και πρότεινε μεταφορά.

# ───────────── Elasticsearch Vector Search ─────────────
elasticsearch:
  enabled: true
  hosts: ["http://192.168.1.4:9200"]
  username: null
  password: null
  api_key: null
  index: null
  indexes:
    - name: "ai_docs_vectors"
      role: "knowledge"
      searchable: true
      embedding_model: "text-embedding-3-small"
      text_field: "content"  # change to the actual field that holds the document text if different
    - name: "ai_calls_conversations"
      role: "conversation_memory"
      searchable: false
      embedding_model: "text-embedding-3-large"
      text_field: "transcript"
  vector_field: "embedding"
  text_field: "content"
  metadata_fields: ["title", "section"]
  top_k: 5
  num_candidates: 64
  min_score: 0.35
  embedding_model: "text-embedding-3-small"
  conversation_log_enabled: true
  request_timeout: 12.0
  verify_certs: true
  ca_certs: null

# ───────────── TTS ─────────────
tts:
  model: "gpt-4o-mini-tts"
  voice: "onyx"
  trailing_silence_ms: 280
  gain_db: 2.5
  timeout: 25.0
  max_text_length: 1200
  chunk_soft_limit: 260
  speed: 1.25
  prosody_enhancement: true

# ───────────── STT ─────────────
stt:
  primary_model: "gpt-4o-transcribe"
  fallback_model: "whisper-1"
  language: "el"
  prompt: >
    Ελληνικός προφορικός λόγος, τηλεφωνική κλήση. Γράψε ακριβώς ό,τι ακούς, με σωστή στίξη.
  temperature: 0.0
  context_aware: true
  common_corrections:
    "τόνοι": "οθόνη"
    "μαύροι": "μαύρη"
    "μαύρες": "μαύρη"

# ───────────── Διαλογική Ροή ─────────────
dialog:
  leading_silence_ms: 60
  max_turns: 0  # 0 σημαίνει άπειρη διάρκεια έως ότου ο καλών να τερματίσει
  goodbye_phrases: ["αντίο", "ευχαριστώ", "τέλος", "bye", "thank you", "thanks", "σταμάτα", "τέλεια"]

# ───────────── VAD ─────────────
vad:
  frame_ms: 10
  start_hang_ms: 240
  end_silence_ms: 2200
  pause_grace_ms: 4500
  min_speech_ms: 700
  max_utterance_ms: 30000
  auto_calibrate_ms: 1200
  energy_factor: 1.5
  energy_floor: 0.015
  max_zcr: 0.35
  adaptive_silence: true
  speech_extension_ms: 2000
  min_speech_between_pauses: 500
  pre_roll_ms: 800
  total_timeout_sec: 120

# ───────────── Barge-in ─────────────
barge_in:
  enabled: true
  pre_calibrate_ms: 400
  frame_ms: 20
  start_hang_ms: 120
  hold_ms: 80
  echo_corr_thresh: 0.70
  energy_factor: 3.0
  energy_floor: 0.03
  max_zcr: 0.30
  min_snr_db: 8.0

# ───────────── Μεταφορά Κλήσης ─────────────
transfer:
  enabled: true
  technician_extension: "7633"
  transfer_prompt: "Να σας συνδέσω με τεχνικό για άμεση βοήθεια;"
  transfer_confirmation: "Σας συνδέω με τον τεχνικό. Παρακαλώ περιμένετε λίγο."
  transfer_timeout_sec: 30
  context: "from-internal"
  technician_redirect_endpoint: ""

# ───────────── Logging ─────────────
logging:
  level: "INFO"
  file: "ai_agent.log"
  max_bytes: 10485760  # 10 MB
  backup_count: 5
  console: true 
